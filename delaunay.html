<html>
<head>
	<script src="https://unpkg.com/delaunator@4.0.1/delaunator.min.js"></script>
</head>
<body>

<canvas id = "tricanvas" width = "600" height = "600" style="border:1px solid #000000;">
</canvas>

<script>
	let canvas = document.getElementById('tricanvas');
	let ctx = canvas.getContext("2d"); //For drawing
	//Need this to disable that annoying menu that pops up on right click
	canvas.addEventListener("contextmenu", function(e){ e.stopPropagation(); e.preventDefault(); return false; }); 

	let points = [];

	/**
	 * Return mouse position with respect to the canvas after
	 * doing a coordinate transformation from global mouse coordinate
	*/
	function getMousePos(canvas, evt) {
		let rect = canvas.getBoundingClientRect();
		return {
			X: evt.clientX - rect.left,
			Y: evt.clientY - rect.top
		};
	}

	function repaint() {
		const dW = 5;
		const W = canvas.width;
		const H = canvas.height;
		ctx.clearRect(0, 0, W, H); // Puts white over everything to clear it

		ctx.fillStyle = [0, 0, 0];
		points.forEach(function(p) {
			ctx.fillRect(p[0]-dW, p[1]-dW, dW*2+1, dW*2+1);
		});

		/*
		    //Draw triangle edges
			//TODO: Finish this
			ctx.fillStyle = "#000000";
			for (var i = 0; i < Ps.length; i++) {
				ctx.beginPath();
				ctx.moveTo(x0, y0);
				ctx.lineTo(x1, y1);
				ctx.stroke();        
			}
		*/

	}

	function next_halfedge(e) { return (e % 3 == 2) ? e-2 : e+1; }

	function selectPoint(evt) {
		let mousePos = getMousePos(canvas, evt);
		const X = mousePos.X;
		const Y = mousePos.Y
		let clickType = "LEFT";
		evt.preventDefault();
		if (evt.which) {
			if (evt.which == 3) clickType = "RIGHT";
			if (evt.which == 2) clickType = "MIDDLE";
		}
		else if (evt.button) {
			if (evt.button == 2) clickType = "RIGHT";
			if (evt.button == 4) clickType = "MIDDLE";
		}

		if (clickType == "LEFT") {
			points.push([X, Y]);
		}
		else if(clickType == "RIGHT") {
			points.pop();
		}
		delaunay = Delaunator.from(points);
		console.log(delaunay.triangles);

		/*for (let e = 0; e < delaunay.triangles.length; e++) {
			if (e > delaunay.halfedges[e]) {
				const p = points[delaunay.triangles[e]];
				const q = points[delaunay.triangles[next_halfedge(e)]];
				callback(e, p, q);
			}
   		}*/

		for (let halfedge_id = 0; halfedge_id < delaunay.triangles.length; halfedge_id++) {
    		if (halfedge_id < delaunay.halfedges[halfedge_id]) {
        		let p = points[halfedge_id];
        		let q = points[next_halfedge(halfedge_id)];
        	
				// draw edge p to q
				
				ctx.beginPath();
				ctx.moveTo(p[0],p[1]);
				ctx.lineTo(q[0],q[1]);
				ctx.stroke();
   		 	}
		}

		repaint();
	}


	canvas.addEventListener("mousedown", selectPoint);
	canvas.addEventListener("touchstart", selectPoint); //Works on mobile devices!
</script>


</body>
</html>