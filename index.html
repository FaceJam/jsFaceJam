<html>
<head>
    <script src="libs/face-api.js"></script>
    <script src="libs/face-api.min.js"></script>
    <script src="https://unpkg.com/delaunator@4.0.1/delaunator.min.js"></script>
    <script src="shaders.js"></script>
    <script src="texture.js"></script>
    <script src="faceutils.js"></script>
    <script src="facecanvas.js"></script>
    <script src="debugcanvas.js"></script>
    <link rel="stylesheet" href="styles.css">
    <meta charset="utf-8" />
</head>
<body>

    <div class="tabmenu">
        <button type="button" onclick="viewDebug()" id="debugbutton" class="active">Debug Canvas</button>
        <button type="button" onclick="viewFace()" id="facebutton" class="">Face Canvas</button>
    </div>

    <canvas id = "DebugCanvas" width = "800" height = "800" style="border:1px solid #000000;">
    </canvas>

    <canvas id = "FaceCanvas" width = "800" height = "800" style="border:1px solid #000000;">
    </canvas>



<script>
    // Points, tris, width, and height are global variables for now
    // since they're shared between canvases
    let points = [];
    let tris = [];
    let W = 1;
    let H = 1;

    let faceCanvas = new FaceCanvas();
    let debugCanvas = new DebugCanvas();

    // Code to toggle back and forth between canvases
    let debugbutton = document.getElementById("debugbutton");
    let facebutton = document.getElementById("facebutton");
    function viewDebug() {
        activeCanvas = debugCanvas;
        debugbutton.className = "active";
        debugCanvas.canvas.style.display = "block";
        debugCanvas.canvas.active = true;
        facebutton.className = "";
        faceCanvas.canvas.style.display = "none";
        faceCanvas.canvas.active = false;
        requestAnimationFrame(activeCanvas.repaint);
    }
    function viewFace() {
        activeCanvas = faceCanvas;
        debugbutton.className = "";
        debugCanvas.canvas.style.display = "none";
        debugCanvas.canvas.active = false;
        facebutton.className = "active";
        faceCanvas.canvas.style.display = "block";
        faceCanvas.canvas.active = true;
        requestAnimationFrame(activeCanvas.repaint);
    }
    viewDebug(); // Active canvas is debug canvas initially


    // Code to initialize delaunay triangulation, which is called
    // when facial landmarks have been initialized
    function updateDelaunay() {
        let delaunay = Delaunator.from(points);
        tris = delaunay.triangles;
        faceCanvas.setupShaders(points, tris, W, H);
        faceCanvas.updateVertexBuffer(points, W, H);
        activeCanvas.repaint();
    }

    // Load image that goes to texture
    const image = new Image();
    image.onload = function() {
        let res = facecanvas.loadTexture(image);
        W = res.width;
        H = res.height;
        faceCanvas.updateTexture(res.texture);
        debugCanvas.img = image;
        activeCanvas.repaint();
        getFaces(image); // Initialize facial landmarks
    }
    image.url = "hannibal.jpg";


</script>

</body>
</html>
