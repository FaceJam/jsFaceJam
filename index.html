<html>
<head>
    <script src="libs/face-api.js"></script>
    <script src="libs/face-api.min.js"></script>
    <script src="libs/numeric.js"></script>
    <script src="https://unpkg.com/delaunator@4.0.1/delaunator.min.js"></script>
    <script src="shaders.js"></script>
    <script src="texture.js"></script>
    <script src="faceutils.js"></script>
    <script src="facecanvas.js"></script>
    <script src="debugcanvas.js"></script>
    <link rel="stylesheet" href="styles.css">
    <meta charset="utf-8" />
</head>
<body>

    <div class="tabmenu">
        <button type="button" onclick="viewDebug()" id="debugbutton" class="active">Debug Canvas</button>
        <button type="button" onclick="viewFace()" id="facebutton" class="">Face Canvas</button>
    </div>

    <canvas id = "DebugCanvas" width = "800" height = "800" style="border:1px solid #000000;">
    </canvas>

    <canvas id = "FaceCanvas" width = "800" height = "800" style="border:1px solid #000000;">
    </canvas>

    <div id="imgdiv">
        <img src = "1.png" id="faceImg">
    </div>



<script>
    // Points, tris, width, and height are global variables for now
    // since they're shared between canvases
    let points = [];
    let W = 1;
    let H = 1;

    let debugCanvas = new DebugCanvas();
    let activeCanvas = debugCanvas;

    let faceCanvas = document.getElementById('FaceCanvas');
    faceCanvas.addEventListener("contextmenu", function(e){ e.stopPropagation(); e.preventDefault(); return false; }); 
    FaceCanvas(faceCanvas, debugCanvas);
    

    // Code to toggle back and forth between canvases
    let debugbutton = document.getElementById("debugbutton");
    let facebutton = document.getElementById("facebutton");
    function viewDebug() {
        activeCanvas = debugCanvas;
        debugbutton.className = "active";
        debugCanvas.canvas.style.display = "block";
        debugCanvas.canvas.active = true;
        facebutton.className = "";
        faceCanvas.style.display = "none";
        faceCanvas.active = false;
        requestAnimationFrame(activeCanvas.repaint.bind(activeCanvas));
    }
    function viewFace() {
        activeCanvas = faceCanvas;
        debugbutton.className = "";
        debugCanvas.canvas.style.display = "none";
        debugCanvas.canvas.active = false;
        facebutton.className = "active";
        faceCanvas.style.display = "block";
        faceCanvas.active = true;
        requestAnimationFrame(activeCanvas.repaint.bind(activeCanvas));
    }
    viewDebug(); // Active canvas is debug canvas initially


    // Code to initialize delaunay triangulation, which is called
    // when facial landmarks have been initialized
    function updateDelaunay(img) {
        faceCanvas.setupShader(points, W, H);
        faceCanvas.animating = true;
        requestAnimationFrame(activeCanvas.repaint.bind(activeCanvas));
    }

    // Load image that goes to texture
    const image = document.getElementById("faceImg");
    image.onload = function() {
        let texture = loadTexture(faceCanvas.gl, image);
        W = image.width;
        H = image.height;
        faceCanvas.updateTexture(texture);
        debugCanvas.img = image;
        document.getElementById("imgdiv").style.display = "none";
        requestAnimationFrame(activeCanvas.repaint.bind(activeCanvas));
        getFaces(image); // Initialize facial landmarks*/
        updateDelaunay();
    }



</script>

</body>
</html>
