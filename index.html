<html>
<head>
    <script src="libs/jquery-3.5.1.min.js"></script>
    <script src="libs/face-api.js"></script>
    <script src="libs/face-api.min.js"></script>
    <script src="PCA/numeric-1.2.6.min.js"></script>
    <script src="https://unpkg.com/delaunator@4.0.1/delaunator.min.js"></script>
    <script src="shaders.js"></script>
    <script src="texture.js"></script>
    <script src="expressionsmodel.js"></script>
    <script src="faceutils.js"></script>
    <script src="facecanvas.js"></script>
    <script src="debugcanvas.js"></script>
    <link rel="stylesheet" href="styles.css">
    <meta charset="utf-8" />
</head>
<body>

    <div class="tabmenu">
        <button type="button" onclick="viewDebug()" id="debugbutton" class="active">Debug Canvas</button>
        <button type="button" onclick="viewFace()" id="facebutton" class="">Face Canvas</button>
    </div>

    <canvas id = "DebugCanvas" width = "800" height = "800" style="border:1px solid #000000;">
    </canvas>

    <canvas id = "FaceCanvas" width = "800" height = "800" style="border:1px solid #000000;">
    </canvas>

    <div id="imgdiv">
        <img src = "hannibal.jpg" id="faceImg">
    </div>



<script>
    let debugCanvas = new DebugCanvas();
    let activeCanvas = debugCanvas;
    let faceCanvas = new FaceCanvas(debugCanvas);
    

    // Code to toggle back and forth between canvases
    let debugbutton = document.getElementById("debugbutton");
    let facebutton = document.getElementById("facebutton");
    function viewDebug() {
        activeCanvas = debugCanvas;
        debugbutton.className = "active";
        debugCanvas.canvas.style.display = "block";
        debugCanvas.setActive();
        facebutton.className = "";
        faceCanvas.canvas.style.display = "none";
        faceCanvas.setInactive();
    }
    function viewFace() {
        activeCanvas = faceCanvas;
        debugbutton.className = "";
        debugCanvas.canvas.style.display = "none";
        debugCanvas.setActive();
        facebutton.className = "active";
        faceCanvas.canvas.style.display = "block";
        faceCanvas.setInactive();
    }
    viewDebug(); // Active canvas is debug canvas initially


    // Code to initialize delaunay triangulation, which is called
    // when facial landmarks have been initialized
    function updateDelaunay(img) {
        faceCanvas.animating = true;
        debugCanvas.setPoints(points);
        requestAnimationFrame(activeCanvas.repaint.bind(activeCanvas));
    }

    // Load image that goes to texture
    const image = document.getElementById("faceImg");
    image.onload = function() {
        let texture = loadTexture(faceCanvas.gl, image);
        let W = image.width;
        let H = image.height;
        faceCanvas.updateTexture(texture);
        debugCanvas.img = image;
        document.getElementById("imgdiv").style.display = "none";
        requestAnimationFrame(activeCanvas.repaint.bind(activeCanvas));
        // Initialize facial landmarks
        getFacialLandmarks(image).then(points => {
            console.log(points);
            faceCanvas.animating = true;
            faceCanvas.setPoints(points, W, H);
            requestAnimationFrame(activeCanvas.repaint.bind(activeCanvas));
        }); 
    }



</script>

</body>
</html>
